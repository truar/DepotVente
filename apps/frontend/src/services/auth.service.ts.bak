import { apiClient } from '@/lib/api-client'

export interface User {
  id: string
  firstName: string
  lastName: string
  email?: string
}

export interface LoginCredentials {
  email: string
  password: string
}

export interface LoginResponse {
  token: string
}

export interface AuthenticatedUser {
  payload: User
}

/**
 * Service d'authentification
 * Gère tous les appels API liés à l'authentification
 */
export const authService = {
  /**
   * Connexion de l'utilisateur
   */
  async login(credentials: LoginCredentials): Promise<LoginResponse> {
    return apiClient.post<LoginResponse>('/signin', credentials)
  },

  /**
   * Récupérer les informations de l'utilisateur connecté
   */
  async getCurrentUser(): Promise<AuthenticatedUser> {
    return apiClient.get<AuthenticatedUser>('/protected')
  },

  /**
   * Déconnexion de l'utilisateur
   * (Pour l'instant juste côté client, mais pourrait appeler une API)
   */
  async logout(): Promise<void> {
    // Ici on pourrait appeler une API pour invalider le token côté serveur
    // await apiClient.post('/logout')
    return Promise.resolve()
  },

  /**
   * Vérifier si le token est toujours valide
   */
  async verifyToken(): Promise<boolean> {
    try {
      await this.getCurrentUser()
      return true
    } catch {
      return false
    }
  },
}
